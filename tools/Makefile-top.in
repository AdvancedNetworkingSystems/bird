# Makefile for in place build of BIRD
# (c) 1999--2000 Martin Mares <mj@ucw.cz>

objdir=@objdir@

all depend tags install install-docs build-tests:
	$(MAKE) -C $(objdir) $@

docs userdocs progdocs:
	$(MAKE) -C doc $@

check: build-tests
	@all_tests=( `find . -name '*_test' -executable` )				; \
	all_tests_source=( `find . -name '*_test.c'` )					; \
	num_build_fail_tests=$$(($${#all_tests_source[@]} - $${#all_tests[@]}))		; \
	test_num=1									; \
	num_succ_tests=0								; \
	num_fail_tests=0								; \
	echo -e "\n== Start all $${#all_tests[@]} unit tests ==\n"			; \
	for test in "$${all_tests[@]}" ; do						  \
		echo -e "[$$((test_num++))/$${#all_tests[@]}] $$test"			; \
		./$$test								  \
			&& num_succ_tests=$$((num_succ_tests+1))			  \
			|| num_fail_tests=$$((num_fail_tests+1))			; \
	done										; \
	echo ""										; \
	echo "------------------------------"						; \
	echo "  Success: $$num_succ_tests"						; \
	echo "  Failure: $$num_fail_tests"						; \
	echo "  Build-Failure: $$num_build_fail_tests"					; \
	echo "------------------------------"

clean:
	$(MAKE) -C $(objdir) clean
	find . -name "*~" -or -name "*.[oa]" -or -name "\#*\#" -or -name TAGS -or -name core -or -name depend -or -name ".#*" | xargs rm -f

distclean: clean
	$(MAKE) -C doc distclean
	rm -rf $(objdir) autom4te.cache
	rm -f config.* configure sysdep/autoconf.h sysdep/paths.h Makefile

